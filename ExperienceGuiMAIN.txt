-- experienceguimain | Version 3.0.3 | MACLIB FIXED AUTH VERSION

local function StartExperienceGui()
    local HttpService = game:GetService("HttpService")
    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer

    -- Destroy leftover maintenance GUI
    for _, gui in ipairs(game.CoreGui:GetChildren()) do
        if gui.Name:find("ExperienceGui - Maintenance") then
            gui:Destroy()
        end
    end

    -- Load MacLib
    local MacLib = loadstring(game:HttpGet("https://github.com/biggaboy212/Maclib/releases/latest/download/maclib.txt"))()

    -- Create Window
    local Window = MacLib:Window({
        Title = "ExperienceGui",
        Subtitle = "Made by CoolDown | MacLib",
        Size = UDim2.fromOffset(900, 680),
        DragStyle = 1,
        ShowUserInfo = true,
        Keybind = Enum.KeyCode.RightControl,
        AcrylicBlur = true,
        Rounding = 8,
    })

    -- Set theme
    Window.Settings.Theme = {
        Accent = Color3.fromRGB(85, 160, 255),
        Background = Color3.fromRGB(12, 15, 22),
        Secondary = Color3.fromRGB(18, 22, 32),
        Text = Color3.fromRGB(240, 240, 240),
        Muted = Color3.fromRGB(160, 160, 160),
    }

    Window:SetScale(1.07)
    Window:SetAcrylicBlurState(true)

    ------------------------
    -- GLOBAL VARIABLES
    ------------------------
    local keyPassed = false
    local VALID_KEYS = {"CoolDownExperience"}
    local authTabGroup = nil

    ------------------------
    -- SIMPLE AUTH USING MACLIB'S BUILT-IN PROMPT
    ------------------------
    -- First, try using MacLib's built-in prompt system
    local function trySimpleAuth()
        local success = Window:Prompt({
            Title = "ExperienceGui Access",
            Description = "Enter Password to continue",
            Inputs = {
                { Name = "Key", Placeholder = "Enter password" }
            },
            Buttons = {
                {
                    Text = "Authenticate",
                    Callback = function(data)
                        local enteredKey = data.Key or ""
                        for _, validKey in ipairs(VALID_KEYS) do
                            if enteredKey == validKey then
                                keyPassed = true
                                return true  -- This tells MacLib to close the prompt
                            end
                        end
                        Window:Notify({
                            Title = "‚ùå Invalid Password",
                            Description = "Please check your password and try again",
                            Lifetime = 3
                        })
                        return false  -- Keep prompt open
                    end
                }
            }
        })
        
        return success
    end

    ------------------------
    -- ALTERNATIVE: TAB-BASED AUTH
    ------------------------
    local function showTabAuth()
        -- Create auth tab group
        authTabGroup = Window:TabGroup()
        local authTab = authTabGroup:Tab({ 
            Name = "üîí AUTHENTICATION", 
            Image = "rbxassetid://10734950309" 
        })
        local authSection = authTab:Section({ Side = "Left" })
        
        authSection:Header({ Name = "ExperienceGui Access" })
        authSection:Label({ Text = "Enter Password" })
        authSection:Label({ Text = "Password required to continue" })
        
        local keyInput = ""
        local keyInputElement = authSection:Input({
            Name = "Password",
            Placeholder = "Enter password here",
            Callback = function(input)
                keyInput = input
            end
        })
        
        authSection:Button({
            Name = "üîì Authenticate",
            Callback = function()
                -- Check if key is valid
                local isValid = false
                for _, validKey in ipairs(VALID_KEYS) do
                    if keyInput == validKey then
                        isValid = true
                        break
                    end
                end
                
                if isValid then
                    keyPassed = true
                    Window:Notify({
                        Title = "‚úÖ Access Granted",
                        Description = "Loading ExperienceGui...",
                        Lifetime = 2
                    })
                    
                    -- Small delay to show notification
                    task.wait(0.5)
                    
                    -- Remove auth tab
                    if authTabGroup then
                        authTabGroup:Remove()
                        authTabGroup = nil
                    end
                    
                    -- Create main UI
                    createMainUI()
                else
                    Window:Notify({
                        Title = "‚ùå Invalid Password",
                        Description = "Please check your password and try again",
                        Lifetime = 3
                    })
                    if keyInputElement and keyInputElement.Set then
                        keyInputElement:Set("")
                    end
                    keyInput = ""
                end
            end
        })
        
        authTab:Select()
    end

    ------------------------
    -- DEBUG: TEST AUTH BYPASS
    ------------------------
    -- Uncomment this to bypass auth for testing:
    -- keyPassed = true

    ------------------------
    -- MAIN UI CREATION FUNCTION
    ------------------------
    function createMainUI()
        print("üöÄ Creating main UI...")
        
        -- Debug check
        if not Window or not Window.TabGroup then
            warn("‚ùå Window or TabGroup method not available!")
            return
        end
        
        ------------------------
        -- CREATE TAB GROUPS
        ------------------------
        local MainTabGroup = Window:TabGroup()
        local ScriptTabGroup = Window:TabGroup()
        local NewsTabGroup = Window:TabGroup()
        
        if not MainTabGroup then
            warn("‚ùå Failed to create MainTabGroup!")
            return
        end
        
        print("‚úÖ Tab groups created")
        
        -- Create tabs
        local HomeTab = MainTabGroup:Tab({ Name = "Home", Image = "rbxassetid://18821914323" })
        local NeedsTab = MainTabGroup:Tab({ Name = "Basic Needs", Image = "rbxassetid://10734950309" })
        local ScriptsTab = MainTabGroup:Tab({ Name = "Script Library", Image = "rbxassetid://10734950309" })
        local ExecTab = ScriptTabGroup:Tab({ Name = "Script Executor", Image = "rbxassetid://10734950309" })
        local ScriptBloxTab = ScriptTabGroup:Tab({ Name = "ScriptBlox", Image = "rbxassetid://10734950309" })
        local FavoritesTab = ScriptTabGroup:Tab({ Name = "Favorites", Image = "rbxassetid://10734950309" })
        local AnnTab = NewsTabGroup:Tab({ Name = "News", Image = "rbxassetid://10734950309" })
        
        print("‚úÖ Tabs created")
        
        ------------------------
        -- HOME TAB
        ------------------------
        local HomeSection = HomeTab:Section({ Side = "Left" })
        HomeSection:Header({ Name = "Welcome to ExperienceGui" })
        HomeSection:Label({ Text = "Made by CoolDown" })
        
        -- Get version
        local version = "3.0.3"
        local ok, result = pcall(function()
            return game:HttpGet("https://raw.githubusercontent.com/ARandomDumDev/ExperienceGui/refs/heads/main/config.json")
        end)
        if ok then
            local decodeOk, decoded = pcall(function()
                return HttpService:JSONDecode(result)
            end)
            if decodeOk and decoded.version then
                version = decoded.version
            end
        end
        
        HomeSection:Label({ Text = "Client: " .. LocalPlayer.Name })
        HomeSection:Label({ Text = "User ID: " .. LocalPlayer.UserId })
        HomeSection:Label({ Text = "Version: " .. version })
        HomeSection:Label({ Text = "‚úÖ Authenticated Successfully" })
        
        ------------------------
        -- BASIC NEEDS TAB
        ------------------------
        local NeedsSection = NeedsTab:Section({ Side = "Left" })
        NeedsSection:Header({ Name = "Movement" })
        
        local walkSpeedValue = 16
        local jumpPowerValue = 50
        
        NeedsSection:Slider({
            Name = "WalkSpeed",
            Default = 16,
            Minimum = 16,
            Maximum = 200,
            Precision = 0,
            Callback = function(Value)
                walkSpeedValue = Value
                if LocalPlayer.Character then
                    local humanoid = LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid")
                    if humanoid then
                        humanoid.WalkSpeed = Value
                    end
                end
            end
        })
        
        NeedsSection:Slider({
            Name = "JumpPower",
            Default = 50,
            Minimum = 50,
            Maximum = 300,
            Precision = 5,
            Callback = function(Value)
                jumpPowerValue = Value
                if LocalPlayer.Character then
                    local humanoid = LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid")
                    if humanoid then
                        humanoid.JumpPower = Value
                    end
                end
            end
        })
        
        NeedsSection:Button({
            Name = "Enable Fly",
            Callback = function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/XNEOFF/FlyGuiV3/main/FlyGuiV3.txt"))()
            end
        })
        
        ------------------------
        -- SCRIPT EXECUTOR TAB
        ------------------------
        local ExecSection = ExecTab:Section({ Side = "Left" })
        ExecSection:Header({ Name = "Execute Code" })
        
        local codeString, urlString = "", ""
        
        ExecSection:Input({
            Name = "Lua Code",
            Placeholder = "Paste Lua code here...",
            Callback = function(text)
                codeString = text
            end
        })
        
        ExecSection:Input({
            Name = "Script URL",
            Placeholder = "Paste script URL here...",
            Callback = function(text)
                urlString = text
            end
        })
        
        ExecSection:Button({
            Name = "‚ñ∂ Execute",
            Callback = function()
                if codeString ~= "" then
                    local success, err = pcall(loadstring(codeString))
                    if success then
                        Window:Notify({
                            Title = "‚úÖ Success",
                            Description = "Code executed successfully",
                            Lifetime = 3
                        })
                    else
                        Window:Notify({
                            Title = "‚ùå Execution Error",
                            Description = tostring(err):sub(1, 100),
                            Lifetime = 5
                        })
                    end
                elseif urlString ~= "" then
                    local success, err = pcall(function()
                        loadstring(game:HttpGet(urlString))()
                    end)
                    if success then
                        Window:Notify({
                            Title = "‚úÖ Success",
                            Description = "Script loaded from URL",
                            Lifetime = 3
                        })
                    else
                        Window:Notify({
                            Title = "‚ùå Download Error",
                            Description = tostring(err):sub(1, 100),
                            Lifetime = 5
                        })
                    end
                else
                    Window:Notify({
                        Title = "‚ö†Ô∏è No Input",
                        Description = "Please enter code or URL first",
                        Lifetime = 3
                    })
                end
                codeString = ""
                urlString = ""
            end
        })
        
        ------------------------
        -- SCRIPT LIBRARY
        ------------------------
        local ScriptsSection = ScriptsTab:Section({ Side = "Left" })
        ScriptsSection:Header({ Name = "Script Library" })
        
        task.spawn(function()
            task.wait(1)
            local success, result = pcall(function()
                return game:HttpGet("https://raw.githubusercontent.com/ARandomDumDev/ExperienceGui/refs/heads/main/Scripts.txt", true)
            end)
            
            if not success then
                ScriptsSection:Label({ Text = "‚ùå Failed to load scripts" })
                return
            end
            
            local scripts
            local decodeSuccess, decodeResult = pcall(function()
                return HttpService:JSONDecode(result)
            end)
            
            if not decodeSuccess or type(decodeResult) ~= "table" then
                ScriptsSection:Label({ Text = "‚ùå Invalid script data" })
                return
            end
            
            scripts = decodeResult
            
            for _, scriptData in ipairs(scripts) do
                ScriptsSection:Button({
                    Name = "‚ñ∂ " .. (scriptData.name or "Unnamed Script"),
                    Callback = function()
                        if scriptData.url then
                            pcall(function()
                                loadstring(game:HttpGet(scriptData.url, true))()
                            end)
                        elseif scriptData.code then
                            pcall(loadstring(scriptData.code))
                        end
                    end
                })
            end
        end)
        
        ------------------------
        -- FAVORITES SYSTEM (Simplified)
        ------------------------
        local savedScripts = {}
        
        local function RefreshFavoritesUI()
            FavoritesTab:ClearSections()
            local FavSection = FavoritesTab:Section({ Side = "Left" })
            FavSection:Header({ Name = "‚≠ê Favorites" })
            
            if #savedScripts == 0 then
                FavSection:Label({ Text = "No favorites saved yet" })
                return
            end
            
            for i, fav in ipairs(savedScripts) do
                FavSection:Button({
                    Name = "‚ñ∂ " .. (fav.title or "Favorite " .. i),
                    Callback = function()
                        if fav.code then
                            pcall(loadstring(fav.code))
                        elseif fav.url then
                            pcall(function()
                                loadstring(game:HttpGet(fav.url, true))()
                            end)
                        end
                    end
                })
                
                FavSection:Button({
                    Name = "üóëÔ∏è Remove",
                    Callback = function()
                        table.remove(savedScripts, i)
                        RefreshFavoritesUI()
                    end
                })
                
                FavSection:Divider()
            end
        end
        
        RefreshFavoritesUI()
        
        ------------------------
        -- SCRIPTBLOX SEARCH (Simplified)
        ------------------------
        local SBSection = ScriptBloxTab:Section({ Side = "Left" })
        SBSection:Header({ Name = "ScriptBlox Search" })
        
        local searchQuery = ""
        
        SBSection:Input({
            Name = "Search",
            Placeholder = "Enter search terms...",
            Callback = function(text)
                searchQuery = text
            end
        })
        
        SBSection:Button({
            Name = "üîç Search",
            Callback = function()
                ScriptBloxTab:ClearSections()
                local ResultsSection = ScriptBloxTab:Section({ Side = "Left" })
                ResultsSection:Header({ Name = "Search Results" })
                
                ResultsSection:Label({ Text = "Searching for: " .. searchQuery })
                -- Note: Actual ScriptBlox API implementation would go here
                ResultsSection:Label({ Text = "ScriptBlox API would be implemented here" })
            end
        })
        
        ------------------------
        -- NEWS TAB
        ------------------------
        local function LoadAnnouncements()
            AnnTab:ClearSections()
            local NewsSection = AnnTab:Section({ Side = "Left" })
            NewsSection:Header({ Name = "üì∞ News & Updates" })
            
            local success, result = pcall(function()
                return game:HttpGet("https://raw.githubusercontent.com/ARandomDumDev/ExperienceGui/refs/heads/main/announcementsChangelogs.json", true)
            end)
            
            if success then
                local data = pcall(function()
                    return HttpService:JSONDecode(result)
                end)
                
                if data and data.announcement then
                    NewsSection:Label({ Text = "üì¢ " .. data.announcement })
                end
                
                if data and data.changelog then
                    NewsSection:Label({ Text = "üìù " .. data.changelog })
                end
            else
                NewsSection:Label({ Text = "‚ùå Failed to load news" })
            end
        end
        
        LoadAnnouncements()
        
        ------------------------
        -- AUTORUN
        ------------------------
        task.spawn(function()
            pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/VapeVoidware/VW-Add/main/loader.lua", true))()
            end)
        end)
        
        ------------------------
        -- SELECT HOME TAB
        ------------------------
        HomeTab:Select()
        
        ------------------------
        -- SUCCESS NOTIFICATION
        ------------------------
        Window:Notify({
            Title = "‚úÖ ExperienceGui Loaded",
            Description = "All features are now available!",
            Lifetime = 3
        })
        
        print("‚úÖ Main UI fully loaded!")
    end

    ------------------------
    -- INITIALIZATION
    ------------------------
    print("üöÄ Starting ExperienceGui...")
    
    -- Try simple prompt auth first
    local authSuccess = trySimpleAuth()
    
    if authSuccess then
        print("‚úÖ Auth successful via prompt")
        keyPassed = true
        createMainUI()
    else
        print("‚ö†Ô∏è Prompt auth failed or was cancelled, using tab auth")
        showTabAuth()
    end
    
    -- For debugging: Uncomment to auto-auth
    -- keyPassed = true
    -- createMainUI()
    
    return Window
end

-- Start the GUI
return StartExperienceGui()
