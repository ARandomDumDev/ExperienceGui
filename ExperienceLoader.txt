-- EXPERIENCE UI LOADER skibdi haek
local configUrl = "https://raw.githubusercontent.com/ARandomDumDev/ExperienceGui/refs/heads/main/config.json"
local scriptUrlOriginal = "https://raw.githubusercontent.com/ARandomDumDev/ExperienceGui/refs/heads/main/ExperienceGuiMAIN.txt"
local scriptUrlBeta = "https://raw.githubusercontent.com/ARandomDumDev/ExperienceGui/refs/heads/main/Beforeupdate.lua"

local HttpService = game:GetService("HttpService")
local currentGui
local currentVersion
local isMaintenance = false

local selectedUI = nil
local hasChosenUI = false

local function unloadGui()
    if currentGui and currentGui.Destroy then
        currentGui:Destroy()
    end
    currentGui = nil
end

-- load a UI from URL, returns the Window or equivalent destroy handle
local function loadGui(which)
    local url
    if which == "beta" then
        url = scriptUrlBeta
    else
        url = scriptUrlOriginal
    end

    local source = game:HttpGet(url)
    local fn = loadstring(source)
    currentGui = fn()
end

local function showMaintenance(message)
    unloadGui()
    local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
    local win = Rayfield:CreateWindow({
        Name = "ExperienceGui - Maintenance",
        LoadingTitle = "Maintenance",
        LoadingSubtitle = "Please wait...",
    })
    win:CreateTab("Notice", 4483362458):CreateLabel(message or "Down for maintenance.")
    currentGui = {
        Destroy = function()
            win:Destroy()
        end
    }
end

local function showUIChooser()
    unloadGui()

    local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
    local win = Rayfield:CreateWindow({
        Name = "ExperienceGui",
        LoadingTitle = "Choose UI",
        LoadingSubtitle = "Original or Beta?",
    })

    local tab = win:CreateTab("Pick One", 4483362458)

    tab:CreateButton({
        Name = "Original UI",
        Callback = function()
            selectedUI = "original"
            hasChosenUI = true
            win:Destroy()
            loadGui("original")
        end
    })

    tab:CreateButton({
        Name = "Beta UI",
        Callback = function()
            selectedUI = "beta"
            hasChosenUI = true
            win:Destroy()
            loadGui("beta")
        end
    })

    currentGui = {
        Destroy = function()
            win:Destroy()
        end
    }
end

-- Poll config.json
task.spawn(function()
    while task.wait(10) do
        local ok, result = pcall(function()
            return game:HttpGet(configUrl)
        end)

        if ok then
            local cfg = HttpService:JSONDecode(result)

            if cfg.maintenance then
                if not isMaintenance then
                    showMaintenance(cfg.message)
                    isMaintenance = true
                end
            else
                if isMaintenance then
                    unloadGui()
                    hasChosenUI = false
                    isMaintenance = false
                end

                if not hasChosenUI then
                    showUIChooser()
                    currentVersion = cfg.version
                elseif not currentGui then
                    loadGui(selectedUI)
                    currentVersion = cfg.version
                elseif cfg.version and cfg.version ~= currentVersion then
                    unloadGui()
                    loadGui(selectedUI)
                    currentVersion = cfg.version
                end
            end
        end
    end
end)
