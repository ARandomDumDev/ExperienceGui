-- ExperienceLoadee 0.04

local configUrl = "https://raw.githubusercontent.com/ARandomDumDev/ExperienceGui/refs/heads/main/config.json"
local scriptUrl = "https://raw.githubusercontent.com/ARandomDumDev/ExperienceGui/refs/heads/main/ExperienceGuiMAIN.txt"

local HttpService = game:GetService("HttpService")

local currentGui
local currentVersion
local isMaintenance = false

local function loadGui()
    local source = game:HttpGet(scriptUrl)
    local fn = loadstring(source)
    currentGui = fn()
end

local function unloadGui()
    if currentGui and currentGui.Destroy then
        currentGui:Destroy()
    end
    currentGui = nil
end

local function showMaintenance(message)
    unloadGui()
    local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
    local win = Rayfield:CreateWindow({
        Name = "ExperienceGui - Maintenance",
        LoadingTitle = "Maintenance",
        LoadingSubtitle = "Please wait...",
    })
    win:CreateTab("Notice", 4483362458):CreateLabel(message or "Down for maintenance.")
    currentGui = win
end

-- Poll config.json
task.spawn(function()
    while task.wait(10) do
        local ok, result = pcall(function()
            return game:HttpGet(configUrl)
        end)

        if ok then
            local cfg = HttpService:JSONDecode(result)

            if cfg.maintenance then
                if not isMaintenance then
                    showMaintenance(cfg.message)
                    isMaintenance = true
                end
            else
                if isMaintenance or not currentGui then
                    unloadGui()
                    loadGui()
                    currentVersion = cfg.version
                    isMaintenance = false
                elseif cfg.version and cfg.version ~= currentVersion then
                    unloadGui()
                    loadGui()
                    currentVersion = cfg.version
                end
            end
        end
    end
end)
