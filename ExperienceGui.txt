--// ExperienceGui Loader
--// Made by CoolDown
--// Password = CoolDownExperience
--// Changes = Script Library safe load + auto-refresh

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Load Rayfield
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- Main Window
local Window = Rayfield:CreateWindow({
    Name = "ExperienceGui",
    LoadingTitle = "ExperienceGui",
    LoadingSubtitle = "Made by CoolDown",
    ConfigurationSaving = { Enabled = true, FolderName = "ExperienceGui", FileName = "Config" },
    Discord = { Enabled = false },
    KeySystem = true,
    KeySettings = {
        Title = "ExperienceGui Access",
        Subtitle = "Enter Password",
        Note = "Password required to continue",
        FileName = "ExperienceKey",
        SaveKey = false,
        GrabKeyFromSite = false,
        Key = {"CoolDownExperience"}
    }
})

-- Tabs
local HomeTab = Window:CreateTab("Home", 4483362458)
local NeedsTab = Window:CreateTab("Basic Needs", 4483362458)
local ScriptsTab = Window:CreateTab("Script Library", 4483362458)

-- Home / Info
HomeTab:CreateLabel("Welcome to ExperienceGui")
HomeTab:CreateLabel("Made by CoolDown")
HomeTab:CreateLabel("Client: " .. LocalPlayer.Name)

-- Basic Needs
NeedsTab:CreateSlider({
    Name = "WalkSpeed",
    Range = {16, 200},
    Increment = 1,
    Suffix = " speed",
    CurrentValue = 16,
    Flag = "WalkSpeed",
    Callback = function(Value)
        LocalPlayer.Character.Humanoid.WalkSpeed = Value
    end,
})

NeedsTab:CreateSlider({
    Name = "JumpPower",
    Range = {50, 300},
    Increment = 5,
    Suffix = " power",
    CurrentValue = 50,
    Flag = "JumpPower",
    Callback = function(Value)
        LocalPlayer.Character.Humanoid.JumpPower = Value
    end,
})

NeedsTab:CreateButton({
    Name = "Enable Fly",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/XNEOFF/FlyGuiV3/main/FlyGuiV3.txt"))()
    end,
})

-- Autorun script
task.defer(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/VapeVoidware/VW-Add/main/loader.lua", true))()
end)

-- Script Library Loader
local function LoadScripts()
    ScriptsTab:Clear() -- remove old buttons/labels before reloading

    local success, result = pcall(function()
        return game:HttpGet("https://raw.githubusercontent.com/ARandomDumDev/ExperienceGui/main/Scripts.txt", true)
    end)

    if not success then
        ScriptsTab:CreateLabel("⚠️ Failed to load Scripts.txt")
        warn("HTTP GET failed:", result)
        return
    end

    local scripts
    local decodeSuccess, decodeResult = pcall(function()
        return HttpService:JSONDecode(result)
    end)

    if decodeSuccess then
        scripts = decodeResult
    else
        ScriptsTab:CreateLabel("⚠️ Failed to decode Scripts.txt")
        warn("JSON Decode failed:", decodeResult)
        return
    end

    if type(scripts) == "table" then
        for _, scriptData in ipairs(scripts) do
            ScriptsTab:CreateButton({
                Name = scriptData.name or "Unnamed Script",
                Callback = function()
                    if scriptData.url then
                        local ok, err = pcall(function()
                            loadstring(game:HttpGet(scriptData.url, true))()
                        end)
                        if not ok then
                            warn("Failed to load script:", scriptData.name, err)
                        end
                    elseif scriptData.code then
                        local ok, err = pcall(function()
                            loadstring(scriptData.code)()
                        end)
                        if not ok then
                            warn("Failed to execute script:", scriptData.name, err)
                        end
                    end
                end
            })
        end
    else
        ScriptsTab:CreateLabel("⚠️ Invalid script format")
    end
end

-- Initial Load (deferred to ensure tabs exist)
task.defer(function()
    task.wait(2)
    local ok, err = pcall(LoadScripts)
    if not ok then
        warn("Initial Script Library load failed:", err)
    end
end)

-- Auto-refresh every 10 seconds
task.spawn(function()
    task.wait(5) -- slight delay before first auto-refresh
    while true do
        local ok, err = pcall(LoadScripts)
        if not ok then
            warn("Script Library refresh error:", err)
        end
        task.wait(10)
    end
end)
